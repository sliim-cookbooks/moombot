def moombot()
{
  name: '<%= node['moombot']['name'] %>',
  home: '<%= node['moombot']['home'] %>',
  server: {
    bind_address: '<%= node['moombot']['server']['bind_address'] %>',
    port: <%= node['moombot']['server']['port'] %>
  },
  cinch: {
    nick: '<%= node['moombot']['cinch']['nick'] %>',
    server: '<%= node['moombot']['cinch']['server'] %>',
    port: <%= node['moombot']['cinch']['port'] %>,
    channels: <%= node['moombot']['cinch']['channels'] %>,
    primary_channel: '<%= node['moombot']['cinch']['primary_channel'] %>',
    ssl: Cinch::Configuration::SSL.new(use: <%= node['moombot']['cinch']['ssl']['use'] %>,
                                       verify: <%= node['moombot']['cinch']['ssl']['verify'] %>),
    plugins: [<%= node['moombot']['plugins'].map {|p| p.capitalize << 'Plugin'}.join ', ' %>]
  }
}
end

plugins_path = File.expand_path('plugins', File.dirname(__FILE__))
<% node['moombot']['plugins'].each do |plugin| %>
load File.expand_path('<%= plugin %>.rb', plugins_path)
<% end %>
